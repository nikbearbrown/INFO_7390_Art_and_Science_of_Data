import{r,E as q,_ as M,cB as I,M as m,O as J,l as ut,n as x,z as ct,bh as dt,cr as pt,C as N,j as c,br as ft,bF as bt,bs as mt,ba as gt,bt as ht,bo as G}from"./index.B-cSXLfy.js";import{u as yt}from"./uniqueId.Dd1Zs3iN.js";import{u as It}from"./FormClearHelper.B56TOIUD.js";import{I as wt}from"./InputInstructions.55wIEZQg.js";import{s as Tt}from"./sprintf.D7DtBTRn.js";import{I as Ct}from"./input.DG8cw326.js";import"./base-input.CPpHElOA.js";var Q=r.forwardRef(function(t,e){var n={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(q,M({iconAttrs:n,iconVerticalAlign:"middle",iconViewBox:"0 0 8 8"},t,{ref:e}),r.createElement("path",{d:"M0 3v2h8V3H0z"}))});Q.displayName="Minus";var Y=r.forwardRef(function(t,e){var n={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(q,M({iconAttrs:n,iconVerticalAlign:"middle",iconViewBox:"0 0 8 8"},t,{ref:e}),r.createElement("path",{d:"M3 0v3H0v2h3v3h2V5h3V3H5V0H3z"}))});Y.displayName="Plus";const vt=ut.getLogger("NumberInput");function St(t){return m(t)||t===""?void 0:t}const z=({value:t,format:e,step:n,dataType:b})=>{if(m(t))return null;let a=St(e);if(m(a)&&J(n)){const d=n.toString();b===I.DataType.FLOAT&&n!==0&&d.includes(".")&&(a=`%0.${d.split(".")[1].length}f`)}if(m(a))return t.toString();try{return Tt.sprintf(a,t)}catch(d){return vt.warn(`Error in sprintf(${a}, ${t}): ${d}`),String(t)}},Vt=(t,e,n)=>m(t)?!1:t-e>=n,kt=(t,e,n)=>m(t)?!1:t+e<=n,Rt=t=>(t.element.dataType===I.DataType.INT?t.widgetMgr.getIntValue(t.element):t.widgetMgr.getDoubleValue(t.element))??t.element.default??null,K=({step:t,dataType:e})=>t||(e===I.DataType.INT?1:.01),xt=x("div",{target:"e5tuigk0"})(({theme:t})=>({display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"center",height:t.sizes.minElementHeight,borderWidth:t.sizes.borderWidth,borderStyle:"solid",borderColor:t.colors.widgetBorderColor??t.colors.secondaryBg,transitionDuration:"200ms",transitionProperty:"border",transitionTimingFunction:"cubic-bezier(0.2, 0.8, 0.4, 1)",borderRadius:t.radii.default,overflow:"hidden","&.focused":{borderColor:t.colors.primary},input:{MozAppearance:"textfield","&::-webkit-inner-spin-button, &::-webkit-outer-spin-button":{WebkitAppearance:"none",margin:t.spacing.none}}})),Dt=x("div",{target:"e5tuigk1"})({display:"flex",flexDirection:"row",alignSelf:"stretch"}),X=x("button",{target:"e5tuigk2"})(({theme:t})=>({margin:t.spacing.none,border:"none",height:t.sizes.full,display:"flex",alignItems:"center",width:t.sizes.numberInputControlsWidth,justifyContent:"center",color:t.colors.bodyText,transition:"color 300ms, backgroundColor 300ms",backgroundColor:t.colors.secondaryBg,"&:hover:enabled, &:focus:enabled":{color:t.colors.white,backgroundColor:t.colors.primary,transition:"none",outline:"none"},"&:active":{outline:"none",border:"none"},"&:last-of-type":{borderTopRightRadius:t.radii.default,borderBottomRightRadius:t.radii.default},"&:disabled":{cursor:"not-allowed",color:t.colors.fadedText40}})),Et=x("div",{target:"e5tuigk3"})(({theme:t,clearable:e})=>({position:"absolute",marginRight:t.spacing.twoXS,left:0,right:`calc(${t.sizes.numberInputControlsWidth} * 2 + ${e?"1em":"0em"})`})),Ft=({disabled:t,element:e,widgetMgr:n,fragmentId:b})=>{var j;const a=ct(),{dataType:d,id:C,formId:p,default:W,format:B,min:g,max:h}=e,[L,Z]=dt(),[s,tt]=r.useState(()=>K(e)),A=Rt({element:e,widgetMgr:n}),[y,w]=r.useState(!1),[l,T]=r.useState(A),[H,v]=r.useState(()=>z({value:A,...e,step:s})),[P,U]=r.useState(!1),S=r.useRef(null),$=r.useRef(yt("number_input_")),V=Vt(l,s,g),k=kt(l,s,h),O=pt({formId:p}),et=O?n.allowFormEnterToSubmit(p):y,rt=P&&L>a.breakpoints.hideWidgetDetails;r.useEffect(()=>{tt(K({step:e.step,dataType:e.dataType}))},[e.dataType,e.step]);const u=r.useCallback(({value:o,source:i})=>{var f;if(J(o)&&(g>o||o>h))(f=S.current)==null||f.reportValidity();else{const R=o??W??null;switch(d){case I.DataType.INT:n.setIntValue({id:C,formId:p},R,i,b);break;case I.DataType.FLOAT:n.setDoubleValue({id:C,formId:p},R,i,b);break;default:throw new Error("Invalid data type")}w(!1),T(R),v(z({value:R,dataType:d,format:B,step:s}))}},[g,h,S,n,b,s,d,C,p,W,B]),ot=r.useCallback(()=>{y&&u({value:l,source:{fromUi:!0}}),U(!1)},[y,l,u]),nt=r.useCallback(()=>{U(!0)},[]),_=r.useCallback(()=>{const{value:o}=e;e.setValue=!1,T(o??null),v(z({value:o??null,...e,step:s})),u({value:o??null,source:{fromUi:!1}})},[e,s,u]);r.useEffect(()=>{e.setValue?_():u({value:l,source:{fromUi:!1}});const o=S.current;if(o){const i=f=>{f.preventDefault()};return o.addEventListener("wheel",i),()=>{o.removeEventListener("wheel",i)}}},[]),e.setValue&&_();const D=m(e.default)&&!t,at=r.useCallback(()=>{const o=e.default??null;T(o),u({value:o,source:{fromUi:!0}})},[e]);It({element:e,widgetMgr:n,onFormCleared:at});const st=o=>{const{value:i}=o.target;if(i==="")w(!0),T(null),v(null);else{let f;e.dataType===I.DataType.INT?f=parseInt(i,10):f=parseFloat(i),w(!0),T(f),v(i)}},E=r.useCallback(()=>{k&&(w(!0),u({value:(l??g)+s,source:{fromUi:!0}}))},[l,g,s,k]),F=r.useCallback(()=>{V&&(w(!0),u({value:(l??h)-s,source:{fromUi:!0}}))},[l,h,s,V]),it=r.useCallback(o=>{const{key:i}=o;switch(i){case"ArrowUp":o.preventDefault(),E();break;case"ArrowDown":o.preventDefault(),F();break}},[E,F]),lt=r.useCallback(o=>{o.key==="Enter"&&(y&&u({value:l,source:{fromUi:!0}}),n.allowFormEnterToSubmit(p)&&n.submitForm(p,b))},[y,l,u,n,p,b]);return N("div",{className:"stNumberInput","data-testid":"stNumberInput",ref:Z,children:[c(ht,{label:e.label,disabled:t,labelVisibility:ft((j=e.labelVisibility)==null?void 0:j.value),htmlFor:$.current,children:e.help&&c(bt,{children:c(mt,{content:e.help,placement:gt.TOP_RIGHT})})}),N(xt,{className:P?"focused":"","data-testid":"stNumberInputContainer",children:[c(Ct,{type:"number",inputRef:S,value:H??"",placeholder:e.placeholder,onBlur:ot,onFocus:nt,onChange:st,onKeyPress:lt,onKeyDown:it,clearable:D,clearOnEscape:D,disabled:t,"aria-label":e.label,id:$.current,overrides:{ClearIconContainer:{style:{padding:0}},ClearIcon:{props:{overrides:{Svg:{style:{color:a.colors.darkGray,padding:a.spacing.threeXS,height:a.sizes.clearIconSize,width:a.sizes.clearIconSize,":hover":{fill:a.colors.bodyText}}}}}},Input:{props:{"data-testid":"stNumberInputField",step:s,min:g,max:h,type:"number",inputMode:""},style:{lineHeight:a.lineHeights.inputWidget,paddingRight:a.spacing.sm,paddingLeft:a.spacing.md,paddingBottom:a.spacing.sm,paddingTop:a.spacing.sm}},InputContainer:{style:()=>({borderTopRightRadius:0,borderBottomRightRadius:0})},Root:{style:{borderTopRightRadius:0,borderBottomRightRadius:0,borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeftWidth:0,borderRightWidth:0,borderTopWidth:0,borderBottomWidth:0,paddingRight:0}}}}),L>a.breakpoints.hideNumberInputControls&&N(Dt,{children:[c(X,{"data-testid":"stNumberInputStepDown",onClick:F,disabled:!V||t,tabIndex:-1,children:c(G,{content:Q,size:"xs",color:V?"inherit":a.colors.disabled})}),c(X,{"data-testid":"stNumberInputStepUp",onClick:E,disabled:!k||t,tabIndex:-1,children:c(G,{content:Y,size:"xs",color:k?"inherit":a.colors.disabled})})]})]}),rt&&c(Et,{clearable:D,children:c(wt,{dirty:y,value:H??"",inForm:O,allowEnterToSubmit:et})})]})},Pt=r.memo(Ft);export{Pt as default};
